<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Цилиндр с числами — Минималка</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap');
  body, html {
    margin:0; padding:0; height:100%;
    background: linear-gradient(135deg, #667eea, #764ba2);
    font-family: 'Montserrat', sans-serif;
    color:#fff;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    user-select:none;
  }
  #score { font-size:2rem; margin-bottom:20px; text-shadow:0 0 10px rgba(0,0,0,.5);}
  .cylinder-container {
    perspective:1200px; width:200px; height:200px; position:relative;
  }
  #cylinder {
    width:150px; height:150px; position:absolute; top:25px; left:25px;
    transform-style: preserve-3d;
    animation:spin 8s linear infinite;
  }
  @keyframes spin {
    to { transform: rotateX(360deg) rotateY(360deg); }
  }
  .face {
    position:absolute; width:100px; height:40px; left:25px; top:55px;
    background: linear-gradient(135deg, #f6d365, #fda085);
    border-radius:20px;
    box-shadow: inset 0 0 10px #fff8cc, 0 6px 15px rgba(253,160,133,.7);
    display:flex; justify-content:center; align-items:center;
    font-weight:700; font-size:1.5rem; color:#4a2c00;
    cursor:pointer; user-select:none;
    transition:background-color .3s ease, transform .3s ease;
  }
  .face:hover { background: linear-gradient(135deg,#fbd786,#f7797d); transform: scale(1.1);}
  .active {
    background:#ffce00; color:#3a2600; transform: scale(1.3);
    box-shadow: 0 0 15px #ffce00;
  }
  .btns {
    margin-top: 230px;
    display:flex; gap:15px;
  }
  button {
    background:linear-gradient(135deg,#ff7e5f,#feb47b);
    border:none; border-radius:25px; padding:12px 30px;
    font-weight:700; font-size:1rem; color:#3a2600;
    cursor:pointer; box-shadow:0 5px 15px rgba(255,126,95,.6);
    user-select:none;
    transition: background .3s ease, transform .2s ease;
  }
  button:hover { background:linear-gradient(135deg,#feb47b,#ff7e5f); transform:scale(1.05);}
  .overlay {
    position: fixed; bottom:0; left:0; right:0;
    background:#22294ddd; color:#fff; max-height:40vh;
    padding:20px; box-shadow:0 -5px 20px rgba(0,0,0,.7);
    display:flex; justify-content:center; align-items:center;
    z-index:10;
    transform: translateY(100%);
    transition: transform .3s ease;
  }
  .overlay.visible { transform: translateY(0); }
  .overlay-content {
    width:100%; max-width:500px;
    background:#3a3f6b; border-radius:15px;
    padding:20px; box-shadow: 0 0 15px #000a;
    text-align:center;
  }
  .close-btn {
    margin-top:15px;
    background:#ff5555; color:#fff; box-shadow:none;
  }
  .close-btn:hover {
    background:#ff2222;
  }
  ul {
    list-style:none; padding:0; margin: 0 0 15px 0;
  }
  li {
    margin-bottom:10px;
    display:flex; justify-content: space-between; align-items:center;
    background: #555a8d;
    padding: 10px 15px;
    border-radius: 10px;
    font-weight: 700;
  }
  li button {
    background: #ffd700;
    color: #4a2c00;
    font-weight: 700;
    border-radius: 12px;
    padding: 6px 15px;
    box-shadow: 0 3px 8px rgba(255,215,0,0.7);
  }
  li button:hover {
    background: #ffec00;
  }
  li.purchased {
    opacity: 0.5;
    pointer-events: none;
  }
</style>
</head>
<body>

<div id="score">Очки: 0</div>

<div class="cylinder-container">
  <div id="cylinder"></div>
</div>

<div class="btns">
  <button id="shop-btn">Магазин</button>
  <button id="tasks-btn">Задания</button>
</div>

<!-- Магазин -->
<div id="shop-overlay" class="overlay">
  <div class="overlay-content">
    <h2>Магазин</h2>
    <ul id="shop-list">
      <!-- Тут будут товары -->
    </ul>
    <button id="close-shop" class="close-btn">Закрыть</button>
  </div>
</div>

<!-- Задания -->
<div id="tasks-overlay" class="overlay">
  <div class="overlay-content">
    <h2>Задания</h2>
    <p>Пока пусто</p>
    <button id="close-tasks" class="close-btn">Закрыть</button>
  </div>
</div>

<script>
(() => {
  const cylinder = document.getElementById('cylinder');
  const scoreDisplay = document.getElementById('score');
  const shopBtn = document.getElementById('shop-btn');
  const tasksBtn = document.getElementById('tasks-btn');
  const shopOverlay = document.getElementById('shop-overlay');
  const tasksOverlay = document.getElementById('tasks-overlay');
  const closeShopBtn = document.getElementById('close-shop');
  const closeTasksBtn = document.getElementById('close-tasks');
  const shopList = document.getElementById('shop-list');

  let score = parseInt(localStorage.getItem('score')) || 0;
  let activeFace = null;
  const numbers = [1,2,3,4,5,6,7,8];
  const radius = 80;
  const angleStep = 360 / numbers.length;

  // Бонусы
  let autoClickerActive = localStorage.getItem('autoClickerActive') === 'true';
  let doublePointsActive = localStorage.getItem('doublePointsActive') === 'true';

  // Обновление отображения очков
  function updateScoreDisplay() {
    scoreDisplay.textContent = `Очки: ${score}`;
  }

  // Создаем числа на цилиндре
  numbers.forEach((num, i) => {
    const f = document.createElement('div');
    f.className = 'face';
    f.textContent = num;
    f.style.transform = `rotateY(${i * angleStep}deg) translateZ(${radius}px)`;
    f.onclick = () => {
      if(activeFace) activeFace.classList.remove('active');
      f.classList.add('active');
      activeFace = f;

      let pointsToAdd = doublePointsActive ? num * 2 : num;
      score += pointsToAdd;
      updateScoreDisplay();
      localStorage.setItem('score', score);
    };
    cylinder.appendChild(f);
  });

  // Товары магазина
  const shopItems = [
    {id: 'autoClicker', name: 'Автокликер', price: 10, purchased: autoClickerActive},
    {id: 'doublePoints', name: 'Ускоритель клика x2', price: 50, purchased: doublePointsActive},
  ];

  // Отрисовка магазина
  function renderShop() {
    shopList.innerHTML = '';
    shopItems.forEach(item => {
      const li = document.createElement('li');
      li.textContent = `${item.name} — ${item.price} очков`;
      if(item.purchased) {
        li.classList.add('purchased');
        li.textContent += ' (Куплено)';
      } else {
        const buyBtn = document.createElement('button');
        buyBtn.textContent = 'Купить';
        buyBtn.onclick = () => buyItem(item.id);
        li.appendChild(buyBtn);
      }
      shopList.appendChild(li);
    });
  }

  // Покупка товара
  function buyItem(id) {
    const item = shopItems.find(i => i.id === id);
    if(!item) return;
    if(item.purchased) {
      alert('Уже куплено!');
      return;
    }
    if(score < item.price) {
      alert('Недостаточно очков!');
      return;
    }

    score -= item.price;
    updateScoreDisplay();
    localStorage.setItem('score', score);

    item.purchased = true;
    if(id === 'autoClicker') {
      autoClickerActive = true;
      localStorage.setItem('autoClickerActive', 'true');
      startAutoClicker();
    }
    if(id === 'doublePoints') {
      doublePointsActive = true;
      localStorage.setItem('doublePointsActive', 'true');
    }
    renderShop();
  }

  // Автокликер
  let autoClickerInterval = null;
  function startAutoClicker() {
    if(autoClickerInterval) return;
    autoClickerInterval = setInterval(() => {
      const randomNum = numbers[Math.floor(Math.random() * numbers.length)];
      let pointsToAdd = doublePointsActive ? randomNum * 2 : randomNum;
      score += pointsToAdd;
      updateScoreDisplay();
      localStorage.setItem('score', score);
    }, 1500);
  }
  if(autoClickerActive) {
    startAutoClicker();
  }

  // Оффлайн-доход
  function getRandomAutoClickPoints() {
    const randomNum = numbers[Math.floor(Math.random() * numbers.length)];
    return doublePointsActive ? randomNum * 2 : randomNum;
  }

  function handleOfflineEarnings() {
    const lastExit = parseInt(localStorage.getItem('lastExitTime'));
    const now = Date.now();

    if (!lastExit || !autoClickerActive) return;

    const secondsAway = Math.floor((now - lastExit) / 1000);
    const interval = 1.5;
    const clicks = Math.floor(secondsAway / interval);
    let totalEarnings = 0;

    for (let i = 0; i < clicks; i++) {
      totalEarnings += getRandomAutoClickPoints();
    }

    if (totalEarnings > 0) {
      score += totalEarnings;
      localStorage.setItem('score', score);
      updateScoreDisplay();
      alert(`Ты был в оффлайне ${secondsAway} сек. Получено ${totalEarnings} очков от автокликера!`);
    }
  }

  // Сохраняем время выхода
  window.addEventListener('beforeunload', () => {
    localStorage.setItem('lastExitTime', Date.now());
  });

  // Управление оверлеями
  function toggleOverlay(overlay, show) {
    if(show) {
      overlay.classList.add('visible');
    } else {
      overlay.classList.remove('visible');
    }
  }

  shopBtn.onclick = () => {
    renderShop();
    toggleOverlay(shopOverlay, true);
    toggleOverlay(tasksOverlay, false);
  };
  tasksBtn.onclick = () => {
    toggleOverlay(tasksOverlay, true);
    toggleOverlay(shopOverlay, false);
  };
  closeShopBtn.onclick = () => toggleOverlay(shopOverlay, false);
  closeTasksBtn.onclick = () => toggleOverlay(tasksOverlay, false);

  handleOfflineEarnings();
  updateScoreDisplay();

})();
</script>