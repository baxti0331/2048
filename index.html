<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Генератор QR-кодов — Файл и Фото</title>
<style>
  body {
    font-family: sans-serif;
    background: #222;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 40px;
    min-height: 100vh;
    flex-direction: column;
    gap: 20px;
  }
  textarea {
    width: 320px;
    height: 80px;
    font-size: 1.1rem;
    padding: 8px;
    border-radius: 8px;
    border: none;
    resize: vertical;
  }
  button {
    padding: 10px 24px;
    font-size: 1.1rem;
    cursor: pointer;
    border-radius: 8px;
    border: none;
    background: #4caf50;
    color: white;
  }
  button:disabled {
    background: #666;
    cursor: not-allowed;
  }
  #qr-image {
    margin-top: 20px;
    max-width: 320px;
    border-radius: 12px;
    background: white;
  }
</style>
</head>
<body>

<h1>Генератор QR-кодов</h1>
<textarea id="input-text" placeholder="Введите текст или ссылку"></textarea>
<button id="generate" disabled>Сгенерировать QR-код</button>
<a id="download-link" style="display:none;" download="qrcode.png">Скачать QR-код</a>
<br />
<img id="qr-image" alt="QR-код появится здесь" />

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
  const input = document.getElementById('input-text');
  const btn = document.getElementById('generate');
  const qrImg = document.getElementById('qr-image');
  const downloadLink = document.getElementById('download-link');

  input.addEventListener('input', () => {
    btn.disabled = input.value.trim().length === 0;
    downloadLink.style.display = 'none';
    qrImg.src = '';
  });

  btn.addEventListener('click', () => {
    const text = input.value.trim();
    if (!text) return;

    // Генерируем QR в canvas
    QRCode.toCanvas(text, { width: 320, errorCorrectionLevel: 'H' }, (err, canvas) => {
      if (err) {
        alert('Ошибка генерации QR-кода');
        console.error(err);
        return;
      }
      // Преобразуем canvas в data URL и показываем в <img>
      const dataUrl = canvas.toDataURL('image/png');
      qrImg.src = dataUrl;

      // Делаем ссылку для скачивания видимой и с data URL
      downloadLink.href = dataUrl;
      downloadLink.style.display = 'inline-block';
      downloadLink.textContent = 'Скачать QR-код';
    });
  });
</script>

</body>
</html>